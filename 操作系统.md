# 面试题——操作系统

## select和epoll

### 概述

- select接口：知道有I/O事件发生，但是不知道是哪个或哪几个I/O流，所以只能轮询全部流，找出发生了I/O的流，所以时间复杂度为O(n)；
- poll接口：将用户传入的数组拷贝到内核空间，然后查询每个fd对应的设备状态，它没有最大连接数的限制；
- epoll接口：epoll会把哪个流发生了怎样的I/O事件通知我们，时间复杂度降为1；

### epoll的实现

在进程启动时建立一个epoll对象（B+树），在需要的时候向这个epoll对象中添加或删除连接。调用epoll_wait()收集发生的事件的连接；

### epoll相对于poll的优点

- select一个进程仅支持打开1024个FD，epoll支持的FD数量远大于此，仅受机器内存限制；
- epoll效率远高于select（尤其是FD数量很大时），因为select需要轮询所有FD的状态，epoll则是等待每个FD上面的callback函数回调；
- epoll通过内核用户空间mmap同一块内存来实现，避免了不必要的内存复制；

### 参考

- https://www.cnblogs.com/aspirant/p/9166944.html
- https://blog.csdn.net/davidsguo008/article/details/73556811

## 自旋锁和互斥锁有什么区别

**互斥锁**

- 同一时刻只能有一个线程持有该锁，同一线程多次加锁会造成死锁；
- 当一个线程持有锁时，其他尝试获取该锁的线程会被挂起，直到持有锁的线程解除锁定；
- 通常通过临界区或互斥量实现；

**自旋锁**

- 同样同一时刻只能有一个线程持有锁，同一线程多次加锁会造成死锁；
- 当一个线程在获取锁时，如果锁已经被其他线程获取，则循环等待，不断判断锁是否能够被成功获取，直到获取锁才退出循环；
- 相比互斥锁，轮询会消耗更多CPU，但是节省了线程从睡眠到唤醒的消耗，所以适用于加锁时间短的场景；

https://blog.csdn.net/fadbgfnbxb/article/details/90048851

## 线程和进程的区别

- 进程是资源分配的最小单位，线程是程序执行的最小单位；
- 进程有自己的独立地址空间，每启动一个进程，系统就会为它分配地址空间，建立数据表来维护代码段、堆栈段和数据段。线程是共享进程的数据空间，因此CPU切换一个线程的花费远比进程要小得多，创建一个线程的开销也比进程小得多；
- 线程之间的通信更方便，同一进程下的线程共享全局变量、静态变量等数据，而进程之间的通信需要用通信的方式（https://blog.csdn.net/zhaohong_bo/article/details/89552188）进行；

## 硬链接与软连接的区别

### Linux ln命令

- 即links命令，为某一个文件在另外一个位置建立一个同步的链接，语法为`ln [参数] [源文件或目录] [目标文件或目录]`
- 所谓的链接可将其视为档案的别名，链接可分为硬链接和软链接，硬链接的意思是一个档案可以有多个名称，软链接的方式则是产生一个特殊的档案，档案的内容是指向另一个档案的位置；

### 硬链接与软链接的区别

- 不能对目录创建硬链接，但是可以创建软链接；
- 不能对不同的文件系统创建硬链接，但是软链接可以跨文件系统；
- 不能对不存在的文件创建硬链接，但是可以创建软链接；
- 硬链接的链接文件和源文件公用一个inode号，而软链接的不同，源文件移动位置后，软链接就失效了，因为软链接就相当于快捷方式；

## CPU负载的含义

- 一段时间内CPU正在处理和等待处理的进程总数与CPU最大处理进程数的比例，对于多核CPU来说最大负载是最大的核心数量；
- 使用top进而top -Hp查找到CPU占用比较大的线程，进而使用jstack来排查Java程序的问题；

## 进程间通信的方式

- 管道pipe：半双工的通信方式，只能在具有亲缘关系（通常是指父子进程关系）的进程间使用；
- 命名管道FIFO：半双工的通信方式，允许无亲缘关系的进程间通信；
- 消息队列MessageQueue：消息队列是由消息的链表，存放在内核中并由消息队列标识符标识。消息队列克服了信号传递信息少、管道只能承载无格式字节流以及缓冲区大小受限等缺点；
- 共享存储：映射一段能被其他进程所访问的内存，是最快的IPC方式，它往往与其他通信机制，如信号量配合使用，来实现进程间的同步和通信；
- 信号量Semaphore：信号量是一个计数器，可以控制多个进程对共享资源的访问，常作为一种锁机制；
- 套接字Socket：可用于不同及其间的进程通信；
- 信号sinal：一种比较复杂的通信方式，用于通知接收进程某个事件已经发生；

## 进程的调度

https://zhuanlan.zhihu.com/p/282017286