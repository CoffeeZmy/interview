# 面试题——计算机网络

## HTTP和HTTPS的区别

- HTTP协议加上加密处理、认证以及完整性保护之后就是HTTPS协议。
- 使用HTTPS协议时，在建立TCP连接之前，客户端和服务器需要先进行SSL/TLS协议的握手，在握手的过程中，客户端与服务器先协商双方使用的加密算法，服务器提供对应算法的公钥和数字证书，然后客户端生成一个秘密数，并使用服务器提供的公钥加密后发送给服务器，最后服务器解密获得这个秘密数并根据秘密数生成会话密钥并返回给客户端，双方使用这个会话密钥对传送的数据进行加密、解密和报文完整性的验证。
- 正是因为使用了这些机制，HTTPS协议比HTTP协议安全，但是HTTPS协议的传输效率比HTTP协议低；
- 其他区别：端口号不同

**为什么HTTPS对传输数据的加解密使用的是共享密钥加密的方式而不是公开密钥加密的方式？**

因为公开密钥加密的算法一般比共享密钥加密算法复杂，所以其中一个原因是为了传输效率

## TCP拥塞控制

### 什么是拥塞？

对网络中某一资源的需求超过了该资源所能提供的可用部分时，网络性能会变坏，这就是拥塞；

### TCP的拥塞控制

- TCP的拥塞控制是基于拥塞窗口的，拥塞窗口会根据网络拥塞程度<u>动态变化</u>（在拥塞程度较小时增大窗口，提高网络利用率，在拥塞程度较大时缩小窗口，以缓解拥塞程度），发送方会让自己的发送窗口大小等于拥塞窗口；
- TCP使用慢开始、拥塞避免、快重传和快恢复四种算法来进行拥塞控制；

### 详细说一下

- **慢开始**：在发送方刚开始发送数据，由小较大逐渐增大拥塞窗口的数值（具体增大方式是每收到一个对新报文的确认，就增大一个单位，所以每经历一个RTT（往返时间），窗口大小增大一倍）；
- **拥塞避免**：当窗口大小达到慢开始的门限时，开始使用拥塞避免算法。拥塞避免算法就是每经历一个RTT时间，窗口大小增大一个单位；
- 如果发送方判断发生了网络拥塞，会把慢开始门限设置为当前窗口大小的一半，然后把窗口大小重置为1，，重新开始慢重传；
- **快重传**：要求接收方在收到新报文时，即使前面还有报文缺失（没收到），也立即回复确认。如果发送方收到3个对前面缺失报文的重复确认时，则认为接收方确实没有收到那个缺失的报文，并立即重发这个缺失的报文；
- **快恢复**：在检测到部分报文丢失时，发送方把慢开始门限设置为当前窗口大小的一半，然后设置窗口大小等于门限值，然后开始使用拥塞避免算法（而不是慢开始算法）；

## 详细描述HTTPS的加密过程

1. **协商加密算法**：首先客户端向服务器发送其支持的加密算法，服务器选择一种算法，返回包含对应算法的公钥的数字证书给客户端；
2. **服务器鉴别**：客户端通过CA的公钥验证服务器发送的证书是可信赖的；
3. **会话秘钥计算**：客户端生成秘密数，使用刚刚服务器发送的公钥对秘密数进行加密，然后发送给服务器，服务器通过私钥解密得到秘密数，然后根据这个秘密数生成会话秘钥，并返回给客户端；
4. **安全数据传输**：客户端与服务器通过会话秘钥对传送的数据进行加解密和验证完整性；

## 三次握手和四次挥手，TIME_WAIT状态

#### 什么是三次握手

- 三次握手是指TCP协议通信的双方建立连接时需要进行三次报文交换；
- 首先由发起建立连接的一方A发送同步位SYN=1，序列号seq=x的请求建立连接的报文，A进入SYN-SENT状态；
- 接受连接的一方B收到A的报文后，回复SYN=1，seq=y，ACK=1，ack=x+1的接受连接的报文，B进入SYN-RCVD状态；
- A收到B的确认报文后，发送ACK=1，seq=x+1，ack=y+1的报文，A进入ESTABLELISHED状态，连接已建立；

#### 为什么需要有第三次握手

主要是为了防止已失效的请求建立连接的报文段发送到B时导致错误。如果A先发送一个连接请求的报文，该报文被滞留在网络中，之后A因为没有收到B的确认而再次发送了建立连接的报文。这种情况下B可能会收到两次建立连接的报文，如果没有第三次握手，会建立两条TCP的连接，导致资源浪费；

#### 第三次握手失败怎么办

B方会启动超时重传机制，即在规定时间内没有收到A的确认报文则重发SYN-RCVD报文，超过一定次数后，B端会关闭这个连接；

### 四次挥手

#### 什么是四次挥手

- 四次挥手是指TCP协议通信的双方在释放连接时需要进行四次报文交换；
- 首先由发起释放连接的一方A停止发送数据并发送FIN=1，seq=x的释放连接的报文，A进入FIN-WAIT-1状态；
- B收到A的释放连接的报文后，回复ACK=1，ack=x+1，seq=y的确认报文，B进入CLOSE-WAIT状态。此时TCP服务器通知高层应用进程从A到B这个方向的连接释放了，TCP处于半关闭的状态，A不再向B发送数据，但是A还需要接收B发送的剩余的数据。A收到这个报文后进入FIN-WAIT-2状态；
- 如果B已经没有要向A发送的数据，则发送FIN=1，ACK=1，seq=z，ack=x+1的释放连接的报文给A，B进入LAST-ACK状态，等待A的确认；
- A收到B的释放连接的报文后，向B回复ACK=1，seq=x+1，ack=z+1的确认报文，A进入到TIME-WAIT状态，此时TCP连接还没有释放掉，必须经过2MSL（最长报文寿命）的时间后，TCP连接才被释放，A进入到CLOSED状态。B则是在收到这个确认报文后就进入CLOSED状态；

#### 为什么A需要进入TIME-WAIT状态并等待2MSL的时间

- 为了保证A发送的最后一个ACK的报文能够到达B，因为如果B收不到这个ACK的报文时，会重发FIN+ACK的报文；
- 防止已失效的连接请求的报文段出现在本连接中，等待2MSL可以确保在本连接持续的时间内产生的所有报文段都从网络中消失了，这样可以使下一个连接中不会出现这种旧的连接请求的报文段；

#### 为什么释放连接时多了一次握手

因为B在收到A的FIN报文时，可能还有没有发送完的数据，所以只能先回复ACK给A，等发完数据后再回复FIN+ACK来释放连接；

## 打开一个URL的过程

打开一个URL大概需要经历DNS解析（把URL解析为服务器IP地址）→TCP连接建立（三次握手，如果是HTTPS，还需要先经过SSL握手）→客户端发送HTTP请求→服务器处理请求并返回处理结果→浏览器解析渲染页面→释放TCP连接（四次挥手）这几个过程；

## HTTP1.0、HTTP1.1和HTTP2.0的区别

### HTTP1.0和HTTP1.1的区别

- **缓存处理**：HTTP1.1引入了更多关于缓存控制的请求头，如Entity tag、If-Unmodified-Since、If-Match等；
- **带宽优化及网络连接的使用**：HTTP1.1引入了range请求头，允许只访问资源的某个部分，方便开发者自由选择以便于充分利用带宽和连接；
- **错误通知的管理**：HTTP1.1中新增了24个错误状态响应码。如409表示请求的资源与当前状态发生冲突，410表示服务器上的某个资源被永久性的删除；
- **长连接**：HTTP1.1支持长连接和请求的流水线（Pipelining）处理（客户端异步发送请求，不用每次等待响应），在一个TCP连接上可以传送多个HTTP请求和响应，减少了建立和关闭连接的消耗和延迟。在HTTP1.1中默认开启Connection：keep-alive，一定程度上弥补了HTTP1.0每次请求都要创建连接的缺点；

### SPDY（Speedy）: HTTP1.x的优化

#### HTTP的瓶颈

- 一条TCP连接只能发送一个请求；
- 请求只能由客户端开启，不可以接收响应以外的指令；
- 冗长的头部，未经压缩就发送；

#### SPDY的优化

spdy是在应用层和运输层之间通过新加会话层的形式运作：

- 降低延迟：采用多路复用，多个请求流共享一个tcp连接；
- 请求优先级：允许给每个request设置优先级，重要的请求先响应；
- header压缩；
- 基于HTTPS的加密协议传输；
- 服务端推送；

SPDY消除Web瓶颈了吗：SPDY消除的是HTTP的瓶颈，很多Web网站存在的问题并非仅仅是HTTP瓶颈导致；

#### HTTP2.0相对于HTTP1.x的新特性

HTTP2.0是基于SPDY设计的，与SPDY不同的是，HTTP2.0支持明文HTTP传输，且使用的请求头压缩算法不同。HTTP2.0想对于HTTP1.x的新特性如下：

- 新的二进制格式：HTTP1.x的解析是基于文本，HTTP2.x的协议则是使用二进制的格式，实现方便且健壮；
- 多路复用：多个请求共享一个TCP连接，降低了请求延迟（节省了创建和关闭连接的时间），提高了带宽利用率；
- header压缩：通信双方对请求头做加解密，减小传输数据的大小，且缓存一份header fields表，既避免了重复header的传输，又减小了需要传输的大小；
- 服务端推送；

## TCP/IP协议

四层网络协议：

- 网络接口层：主机必须使用某种协议与网络相连；
- 网络层：主机可以把分组发往任何网络，并使分组独立地传向目标，如IP协议；
- 传输层：使源端核目的端机器上的对等实体可以进行会话，如TCP和UDP协议；
- 应用层：包含所有的高层协议，如HTTP、FTP、SMTP等；

## HTTP协议

应用层协议，规定了客户端和服务器之间的通信格式，互联网最常用的协议；特点：

- 客户端/服务器的模式；
- 简单快速：只需传请求方法与资源路径就能确定资源；
- 灵活：可以传输任意类型的数据；
- 无连接：HTTP1.0是无连接的，但再HTTP1.1中可以使用keep-alive来复用相同的TCP连接发送多个请求；
- 无状态：服务器不会记录客户端的状态，但是可以使用Cookie和Session来管理客户端状态；

## TCP协议滑动窗口协议

- 滑动窗口协议是传输层进行流控制的一种措施，接收方告诉发送方自己的窗口大小，从而控制发送方的发送速度，达到防止发送方发送速度过快而导致自己被淹没的目的；
- ACK包含两个非常重要的信息：一是期望接收到的下一个字节的序号n，该n代表接收方已经接收到了前n-1个字节的数据。二是当前窗口大小m，如此发送方在接收到ACK包含的这两个数据后就可以计算出还可以发送多少字节的数据给对方，这就是滑动窗口控制流量的基本原理；
- TCP的滑动窗口是动态的，应用程序在需要时（如内存不足时），会缩小TCP的接收窗口，然后TCP协议栈在下个段发送时包含新的窗口大小通知给对端，对端按通知的窗口来改变发送窗口，以此达到减缓发送速率的目的；

## TCP协议与UDP协议的区别

- TCP提供面向连接的、可靠的数据流传输，而UDP提供的是非面向连接的，不可靠的数据流传输；
- TCP注重数据安全性，UDP数据传输快；